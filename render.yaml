services:
  # Этот сервис будет нашим ботом
  - type: worker
    name: cryptobot
    env: python
    plan: pro
    
    # Сначала запускаем наш скрипт, потом все остальное
    buildCommand: "./build.sh && pip install -r requirements.txt && python -m playwright install chromium"
    
    startCommand: "python -m bot.main"
    
    envVars:
      - key: PYTHON_VERSION
        value: '3.11.5'
      - key: BOT_TOKEN
        fromSecret: true
      # Указываем, что URL для Redis нужно взять у создаваемого ниже сервиса
      - key: REDIS_URL
        fromService:
          type: redis
          name: cryptobot-redis
          property: connectionString
      - key: ADMIN_CHAT_ID
        fromSecret: true
      - key: NEWS_CHAT_ID
        fromSecret: true
      - key: CMC_API_KEY
        fromSecret: true
      - key: OPENAI_API_KEY
        fromSecret: true

  # Этот сервис - наша база данных Redis
  - type: redis
    name: cryptobot-redis
    plan: free