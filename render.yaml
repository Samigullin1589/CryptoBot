# ===============================================================
# Файл: render.yaml (ПРОДАКШН-ВЕРСИЯ, АВГУСТ 2025)
# Описание: Конфигурация для Render.com с Health Check,
#           правильными командами и переменными окружения.
# ===============================================================
services:
  # ИСПРАВЛЕНО: Тип сервиса изменен на 'web' для поддержки Health Check.
  - type: web
    name: crypto-bot
    env: python
    pythonVersion: "3.12"
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
    startCommand: python -m bot.main
    envVars:
      - key: PYTHONPATH
        value: .
      # УЛУЧШЕНИЕ: Render автоматически предоставляет эту переменную для web-сервисов.
      - key: PORT
        value: 10000
    # УЛУЧШЕНИЕ: Добавлена проверка работоспособности.
    healthCheck:
      path: /healthz
      initialDelaySeconds: 60 # Даем боту время на запуск перед первой проверкой
    # Автоматический перезапуск при сбоях
    restartPolicy: on-failure

  - type: redis
    name: cache
    ipAllowList: [] # Для простоты. В продакшене лучше указать IP web-сервиса.
    plan: free # 'free' для тестов, платный для продакшена.
    maxmemoryPolicy: allkeys-lru