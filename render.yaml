# ===============================================================
# Файл: render.yaml (ПРОДАКШН-ВЕРСИЯ, АВГУСТ 2025)
# Описание: Конфигурация Render Blueprints: worker + Key Value (Redis).
# Документация: https://render.com/docs/blueprint-spec
# ===============================================================

services:
  # --- Фоновый worker: сам бот (aiogram 3) ---
  - type: worker
    runtime: python
    name: cryptobot-worker
    plan: starter
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
    startCommand: |
      python -m bot.main
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.11
      - key: BOT_TOKEN
        sync: false
      - key: ADMIN_USER_IDS
        sync: false
      - key: TZ
        value: Asia/Tbilisi
      - key: LOG_LEVEL
        value: INFO
      - key: REDIS_URL
        fromService:
          name: cryptobot-kv
          type: keyvalue
          property: connectionString
      - key: OPENAI_API_KEY
        sync: false
      - key: GEMINI_API_KEY
        sync: false
      - key: CRYPTOCOMPARE_API_KEY
        sync: false
      - key: COINGECKO_API_KEY
        sync: false

  # --- Key Value (современная замена типа redis) ---
  - type: keyvalue
    name: cryptobot-kv
    plan: free
    ipAllowList: []
    maxmemoryPolicy: allkeys-lru