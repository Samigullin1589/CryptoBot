# =================================================================================
# render.yaml - ВАРИАНТ A: BACKGROUND WORKER (РЕКОМЕНДУЕТСЯ)
# Дата: 28.10.2025
# Описание: Telegram бот в режиме long polling (не требует порта)
# ✅ ИСПРАВЛЕНО: type: worker вместо web
# ✅ ИСПРАВЛЕНО: IS_WEB_PROCESS: false
# =================================================================================

services:
  # ==================== TELEGRAM BOT WORKER ====================
  - type: worker  # ✅ КРИТИЧНО! Worker, не web
    name: telegram-crypto-bot-worker
    runtime: python
    region: frankfurt  # Или другой регион
    plan: free  # Или starter/standard для production
    
    # Build command
    buildCommand: |
      pip install --upgrade pip setuptools wheel
      pip install -r requirements.txt
    
    # Start command  
    startCommand: python -m bot.main
    
    # Переменные окружения
    envVars:
      # --- Обязательные ---
      - key: BOT_TOKEN
        sync: false  # Секретное значение, устанавливается вручную
      
      - key: REDIS_URL
        sync: false  # Формат: redis://host:port или redis://user:pass@host:port
      
      - key: GEMINI_API_KEY
        sync: false  # Google Gemini API key
      
      - key: ADMIN_USER_IDS
        value: "123456789"  # Замените на реальные Telegram user IDs через запятую
      
      # --- Опциональные ---
      - key: OPENAI_API_KEY
        sync: false  # Опционально для OpenAI
      
      - key: COINGECKO_API_KEY
        sync: false  # Опционально для CoinGecko Pro
      
      - key: CRYPTOCOMPARE_API_KEY
        sync: false  # Опционально для CryptoCompare
      
      - key: ADMIN_CHAT_ID
        sync: false  # Telegram chat ID для админ-уведомлений
      
      - key: NEWS_CHAT_ID
        sync: false  # Telegram chat ID для новостей
      
      # --- Системные ---
      - key: PYTHON_VERSION
        value: "3.11"
      
      - key: IS_WEB_PROCESS
        value: "false"  # ✅ Polling mode (НЕ webhook)
      
      - key: LOG_LEVEL
        value: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
      
      # --- AI настройки ---
      - key: AI__PROVIDER
        value: "gemini"  # gemini или openai
      
      - key: AI__DEFAULT_TEMPERATURE
        value: "0.5"
    
    # Auto deploy при push
    autoDeploy: true

# =================================================================================
# ПРИМЕЧАНИЯ:
# 
# 1. Worker не требует health check и не открывает порты
# 2. Логи доступны в Render Dashboard → Logs
# 3. Для мониторинга используйте админ-уведомления в Telegram
# 4. Free plan: засыпает после 15 мин неактивности, 750 часов/месяц
# 5. Для production рекомендуется Starter plan ($7/мес)
# =================================================================================